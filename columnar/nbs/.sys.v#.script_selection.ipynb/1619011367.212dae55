{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "attempted-packet",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Welcome to JupyROOT 6.20/06\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import selection\n",
    "import weights\n",
    "import btag\n",
    "import root_pandas\n",
    "import importlib\n",
    "import jetmet\n",
    "import test_weights\n",
    "import object_selection"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "framed-designation",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processing: T_TuneZ2_s isData: False isTT: True corrLevel taue_up invert_btag False\n",
      "SF 1.0 1.0\n",
      "(31, 10) (31, 4)\n",
      "before join 21 73146\n",
      "after join 21\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(selection)\n",
    "importlib.reload(jetmet)\n",
    "importlib.reload(test_weights)\n",
    "importlib.reload(object_selection)\n",
    "path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + \"T_TuneZ2_s\" + \".root\"\n",
    "df, jet, tau, met, cut_flow = selection.event_selection(path, isData = False, isTT = True, corrLevel = \"taue_up\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "fresh-sierra",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0      49.796485\n",
       "1      37.311014\n",
       "2     115.593066\n",
       "3      55.193395\n",
       "4     319.741266\n",
       "5     125.922510\n",
       "6     111.933080\n",
       "7      22.201251\n",
       "8      49.698103\n",
       "9      52.085418\n",
       "10     41.938752\n",
       "11     45.010142\n",
       "12     39.632418\n",
       "13     44.856671\n",
       "14    109.832806\n",
       "15     33.897857\n",
       "16     20.339734\n",
       "17    154.428778\n",
       "18    152.522118\n",
       "19     49.219240\n",
       "20     24.658624\n",
       "Name: MET_met, dtype: float64"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[\"MET_met\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "id": "mental-duplicate",
   "metadata": {},
   "outputs": [],
   "source": [
    "met[\"scaled_e\"] = np.sqrt((met[\"px\"]*1.1)**2 + (met[\"py\"]*1.1)**2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "respiratory-democracy",
   "metadata": {},
   "outputs": [],
   "source": [
    "met[\"scaled_e2\"] = met[\"e\"]*1.1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "id": "adult-validation",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>pt</th>\n",
       "      <th>px</th>\n",
       "      <th>py</th>\n",
       "      <th>pz</th>\n",
       "      <th>e</th>\n",
       "      <th>met</th>\n",
       "      <th>scaled_e</th>\n",
       "      <th>scaled_e2</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>227</th>\n",
       "      <td>53.386703</td>\n",
       "      <td>13.169377</td>\n",
       "      <td>51.736904</td>\n",
       "      <td>0.0</td>\n",
       "      <td>53.386703</td>\n",
       "      <td>53.386703</td>\n",
       "      <td>58.725372</td>\n",
       "      <td>58.725376</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>239</th>\n",
       "      <td>37.015484</td>\n",
       "      <td>13.813532</td>\n",
       "      <td>-34.341408</td>\n",
       "      <td>0.0</td>\n",
       "      <td>37.015484</td>\n",
       "      <td>37.015484</td>\n",
       "      <td>40.717033</td>\n",
       "      <td>40.717033</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>255</th>\n",
       "      <td>116.506561</td>\n",
       "      <td>54.449005</td>\n",
       "      <td>-103.000404</td>\n",
       "      <td>0.0</td>\n",
       "      <td>116.506561</td>\n",
       "      <td>116.506561</td>\n",
       "      <td>128.157211</td>\n",
       "      <td>128.157227</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>646</th>\n",
       "      <td>52.724148</td>\n",
       "      <td>-45.491230</td>\n",
       "      <td>-26.653028</td>\n",
       "      <td>0.0</td>\n",
       "      <td>52.724148</td>\n",
       "      <td>52.724148</td>\n",
       "      <td>57.996567</td>\n",
       "      <td>57.996563</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>815</th>\n",
       "      <td>324.515289</td>\n",
       "      <td>314.713928</td>\n",
       "      <td>79.153648</td>\n",
       "      <td>0.0</td>\n",
       "      <td>324.515289</td>\n",
       "      <td>324.515289</td>\n",
       "      <td>356.966797</td>\n",
       "      <td>356.966827</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>891</th>\n",
       "      <td>127.260880</td>\n",
       "      <td>12.007481</td>\n",
       "      <td>126.693146</td>\n",
       "      <td>0.0</td>\n",
       "      <td>127.260880</td>\n",
       "      <td>127.260880</td>\n",
       "      <td>139.986969</td>\n",
       "      <td>139.986969</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>900</th>\n",
       "      <td>21.658754</td>\n",
       "      <td>21.551687</td>\n",
       "      <td>-2.150911</td>\n",
       "      <td>0.0</td>\n",
       "      <td>21.658754</td>\n",
       "      <td>21.658754</td>\n",
       "      <td>23.824629</td>\n",
       "      <td>23.824631</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>918</th>\n",
       "      <td>114.165321</td>\n",
       "      <td>-1.253546</td>\n",
       "      <td>114.158440</td>\n",
       "      <td>0.0</td>\n",
       "      <td>114.165321</td>\n",
       "      <td>114.165321</td>\n",
       "      <td>125.581856</td>\n",
       "      <td>125.581856</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1144</th>\n",
       "      <td>22.905081</td>\n",
       "      <td>-3.732536</td>\n",
       "      <td>-22.598913</td>\n",
       "      <td>0.0</td>\n",
       "      <td>22.905081</td>\n",
       "      <td>22.905079</td>\n",
       "      <td>25.195587</td>\n",
       "      <td>25.195589</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1219</th>\n",
       "      <td>48.891224</td>\n",
       "      <td>-48.183498</td>\n",
       "      <td>8.288689</td>\n",
       "      <td>0.0</td>\n",
       "      <td>48.891224</td>\n",
       "      <td>48.891224</td>\n",
       "      <td>53.780350</td>\n",
       "      <td>53.780346</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1331</th>\n",
       "      <td>58.048882</td>\n",
       "      <td>50.367134</td>\n",
       "      <td>-28.858694</td>\n",
       "      <td>0.0</td>\n",
       "      <td>58.048882</td>\n",
       "      <td>58.048882</td>\n",
       "      <td>63.853771</td>\n",
       "      <td>63.853771</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1428</th>\n",
       "      <td>42.279060</td>\n",
       "      <td>-40.457554</td>\n",
       "      <td>-12.276210</td>\n",
       "      <td>0.0</td>\n",
       "      <td>42.279060</td>\n",
       "      <td>42.279060</td>\n",
       "      <td>46.506969</td>\n",
       "      <td>46.506966</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1429</th>\n",
       "      <td>48.390121</td>\n",
       "      <td>41.370564</td>\n",
       "      <td>25.101395</td>\n",
       "      <td>0.0</td>\n",
       "      <td>48.390121</td>\n",
       "      <td>48.390121</td>\n",
       "      <td>53.229130</td>\n",
       "      <td>53.229134</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1462</th>\n",
       "      <td>41.387737</td>\n",
       "      <td>22.759224</td>\n",
       "      <td>34.568230</td>\n",
       "      <td>0.0</td>\n",
       "      <td>41.387737</td>\n",
       "      <td>41.387737</td>\n",
       "      <td>45.526512</td>\n",
       "      <td>45.526512</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1563</th>\n",
       "      <td>45.199810</td>\n",
       "      <td>31.399868</td>\n",
       "      <td>-32.512630</td>\n",
       "      <td>0.0</td>\n",
       "      <td>45.199810</td>\n",
       "      <td>45.199810</td>\n",
       "      <td>49.719791</td>\n",
       "      <td>49.719791</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1690</th>\n",
       "      <td>107.029106</td>\n",
       "      <td>93.234886</td>\n",
       "      <td>-52.559345</td>\n",
       "      <td>0.0</td>\n",
       "      <td>107.029106</td>\n",
       "      <td>107.029106</td>\n",
       "      <td>117.732018</td>\n",
       "      <td>117.732018</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1721</th>\n",
       "      <td>34.470093</td>\n",
       "      <td>-21.115807</td>\n",
       "      <td>-27.245369</td>\n",
       "      <td>0.0</td>\n",
       "      <td>34.470093</td>\n",
       "      <td>34.470093</td>\n",
       "      <td>37.917103</td>\n",
       "      <td>37.917103</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1726</th>\n",
       "      <td>20.466646</td>\n",
       "      <td>-11.132802</td>\n",
       "      <td>17.173944</td>\n",
       "      <td>0.0</td>\n",
       "      <td>20.466646</td>\n",
       "      <td>20.466646</td>\n",
       "      <td>22.513313</td>\n",
       "      <td>22.513311</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1841</th>\n",
       "      <td>154.285263</td>\n",
       "      <td>146.854584</td>\n",
       "      <td>-47.304054</td>\n",
       "      <td>0.0</td>\n",
       "      <td>154.285263</td>\n",
       "      <td>154.285263</td>\n",
       "      <td>169.713791</td>\n",
       "      <td>169.713791</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1845</th>\n",
       "      <td>153.828796</td>\n",
       "      <td>-74.694244</td>\n",
       "      <td>-134.477020</td>\n",
       "      <td>0.0</td>\n",
       "      <td>153.828796</td>\n",
       "      <td>153.828796</td>\n",
       "      <td>169.211685</td>\n",
       "      <td>169.211685</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1846</th>\n",
       "      <td>53.806496</td>\n",
       "      <td>-52.703968</td>\n",
       "      <td>-10.836556</td>\n",
       "      <td>0.0</td>\n",
       "      <td>53.806496</td>\n",
       "      <td>53.806496</td>\n",
       "      <td>59.187149</td>\n",
       "      <td>59.187145</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1890</th>\n",
       "      <td>24.258339</td>\n",
       "      <td>-6.998435</td>\n",
       "      <td>-23.226902</td>\n",
       "      <td>0.0</td>\n",
       "      <td>24.258339</td>\n",
       "      <td>24.258337</td>\n",
       "      <td>26.684174</td>\n",
       "      <td>26.684174</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              pt          px          py   pz           e         met  \\\n",
       "227    53.386703   13.169377   51.736904  0.0   53.386703   53.386703   \n",
       "239    37.015484   13.813532  -34.341408  0.0   37.015484   37.015484   \n",
       "255   116.506561   54.449005 -103.000404  0.0  116.506561  116.506561   \n",
       "646    52.724148  -45.491230  -26.653028  0.0   52.724148   52.724148   \n",
       "815   324.515289  314.713928   79.153648  0.0  324.515289  324.515289   \n",
       "891   127.260880   12.007481  126.693146  0.0  127.260880  127.260880   \n",
       "900    21.658754   21.551687   -2.150911  0.0   21.658754   21.658754   \n",
       "918   114.165321   -1.253546  114.158440  0.0  114.165321  114.165321   \n",
       "1144   22.905081   -3.732536  -22.598913  0.0   22.905081   22.905079   \n",
       "1219   48.891224  -48.183498    8.288689  0.0   48.891224   48.891224   \n",
       "1331   58.048882   50.367134  -28.858694  0.0   58.048882   58.048882   \n",
       "1428   42.279060  -40.457554  -12.276210  0.0   42.279060   42.279060   \n",
       "1429   48.390121   41.370564   25.101395  0.0   48.390121   48.390121   \n",
       "1462   41.387737   22.759224   34.568230  0.0   41.387737   41.387737   \n",
       "1563   45.199810   31.399868  -32.512630  0.0   45.199810   45.199810   \n",
       "1690  107.029106   93.234886  -52.559345  0.0  107.029106  107.029106   \n",
       "1721   34.470093  -21.115807  -27.245369  0.0   34.470093   34.470093   \n",
       "1726   20.466646  -11.132802   17.173944  0.0   20.466646   20.466646   \n",
       "1841  154.285263  146.854584  -47.304054  0.0  154.285263  154.285263   \n",
       "1845  153.828796  -74.694244 -134.477020  0.0  153.828796  153.828796   \n",
       "1846   53.806496  -52.703968  -10.836556  0.0   53.806496   53.806496   \n",
       "1890   24.258339   -6.998435  -23.226902  0.0   24.258339   24.258337   \n",
       "\n",
       "        scaled_e   scaled_e2  \n",
       "227    58.725372   58.725376  \n",
       "239    40.717033   40.717033  \n",
       "255   128.157211  128.157227  \n",
       "646    57.996567   57.996563  \n",
       "815   356.966797  356.966827  \n",
       "891   139.986969  139.986969  \n",
       "900    23.824629   23.824631  \n",
       "918   125.581856  125.581856  \n",
       "1144   25.195587   25.195589  \n",
       "1219   53.780350   53.780346  \n",
       "1331   63.853771   63.853771  \n",
       "1428   46.506969   46.506966  \n",
       "1429   53.229130   53.229134  \n",
       "1462   45.526512   45.526512  \n",
       "1563   49.719791   49.719791  \n",
       "1690  117.732018  117.732018  \n",
       "1721   37.917103   37.917103  \n",
       "1726   22.513313   22.513311  \n",
       "1841  169.713791  169.713791  \n",
       "1845  169.211685  169.211685  \n",
       "1846   59.187149   59.187145  \n",
       "1890   26.684174   26.684174  "
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "met"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "id": "incorrect-landscape",
   "metadata": {},
   "outputs": [],
   "source": [
    "met_p4 = uproot_methods.classes.TLorentzVector.TLorentzVectorArray(met[\"px\"], met[\"py\"],\n",
    "                                                                   met[\"pz\"], met[\"e\"])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "gorgeous-brand",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<TLorentzVectorArray [TLorentzVector(13.169, 51.737, 0, 53.387) TLorentzVector(13.814, -34.341, 0, 37.015) TLorentzVector(54.449, -103, 0, 116.51) ... TLorentzVector(-74.694, -134.48, 0, 153.83) TLorentzVector(-52.704, -10.837, 0, 53.806) TLorentzVector(-6.9984, -23.227, 0, 24.258)] at 0x7f3ddeaf4dd0>"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "met_p4"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "opponent-israeli",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "synthetic-cotton",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "after-hayes",
   "metadata": {},
   "outputs": [],
   "source": [
    "data = ['Run2011A_MultiJet', 'Run2011B_MultiJet']\n",
    "mc = ['T_TuneZ2_s', 'WJetsToLNu', 'DYJetsToLL', 'T_TuneZ2_tW', 'T_TuneZ2_t-channel',\n",
    "       'Tbar_TuneZ2_s', 'Tbar_TuneZ2_tW', 'Tbar_TuneZ2_t-channel', 'TTJets']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "veterinary-blackberry",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processing: T_TuneZ2_s isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(30, 9) (30, 4)\n",
      "Processing: WJetsToLNu isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(254, 9) (254, 4)\n",
      "Processing: DYJetsToLL isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(728, 9) (728, 4)\n",
      "Processing: T_TuneZ2_tW isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(632, 9) (632, 4)\n",
      "Processing: T_TuneZ2_t-channel isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(251, 9) (251, 4)\n",
      "Processing: Tbar_TuneZ2_s isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(15, 9) (15, 4)\n",
      "Processing: Tbar_TuneZ2_tW isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(713, 9) (713, 4)\n",
      "Processing: Tbar_TuneZ2_t-channel isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(150, 9) (150, 4)\n",
      "Processing: TTJets isData: False isTT: True corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(98977, 10) (98977, 4)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/test_weights.py:95: RuntimeWarning: invalid value encountered in true_divide\n",
      "  weights = pd.DataFrame({\"btag_weight1\" : pdata/pmc, \"btag_weight1_up\" : pdata_up/pmc,\n",
      "/eos/home-l/llayer/cmsopen/columnar/test_weights.py:96: RuntimeWarning: invalid value encountered in true_divide\n",
      "  \"btag_weight1_down\" : pdata_down/pmc})\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "before join 60493 73146\n",
      "after join 60493\n",
      "Processing: Run2011A_MultiJet isData: True isTT: False corrLevel cent invert_btag False\n",
      "Processing: Run2011A_MultiJet isData: True isTT: False corrLevel cent invert_btag True\n",
      "Processing: Run2011B_MultiJet isData: True isTT: False corrLevel cent invert_btag False\n",
      "Processing: Run2011B_MultiJet isData: True isTT: False corrLevel cent invert_btag True\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(selection)\n",
    "importlib.reload(jetmet)\n",
    "importlib.reload(test_weights)\n",
    "importlib.reload(object_selection)\n",
    "def event_selection():\n",
    "    \n",
    "    samples = {}\n",
    "    cut_flow = []\n",
    "    cut_flow_normed = {}\n",
    "    \n",
    "    for sample in mc + data:\n",
    "        \n",
    "        #!!!!!!! Careful with JER application before Tau?!\n",
    "        \n",
    "        if \"TTJets\" in sample: isTT = True\n",
    "        else: isTT = False\n",
    "            \n",
    "        if \"Run2011\" in sample: isData = True\n",
    "        else: isData = False\n",
    "        \n",
    "        path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + sample + \".root\"\n",
    "        \n",
    "        if isData:\n",
    "            for inv_btag, suffix in zip([False, True], [\"\", \"_QCD\"]):\n",
    "                \n",
    "                df, _, _, ev_count = selection.event_selection(path, isData = isData, isTT = isTT, \n",
    "                                                                          invert_btag = inv_btag)\n",
    "                samples[sample + suffix] = df\n",
    "                ev_count[\"sample\"] = sample + suffix\n",
    "                cut_flow.append(ev_count)\n",
    "        else:\n",
    "            df, _, _, ev_count = selection.event_selection(path, isData = isData, isTT = isTT, corrLevel=\"centJER\")\n",
    "            samples[sample] = df\n",
    "            ev_count[\"sample\"] = sample\n",
    "            cut_flow.append(ev_count)\n",
    "\n",
    "        #print( cut_flow )        \n",
    "        \n",
    "    return samples, cut_flow\n",
    "\n",
    "samples, cut_flow = event_selection()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "governmental-active",
   "metadata": {},
   "outputs": [],
   "source": [
    "import utils"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "distinguished-burst",
   "metadata": {},
   "outputs": [
    {
     "ename": "NotImplementedError",
     "evalue": "Support for generic buffers has not been implemented.",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mNotImplementedError\u001b[0m                       Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-6-5d2c4c007aee>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0mimportlib\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mreload\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mutils\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0mutils\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mprint_yields\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcut_flow\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[0;32m/eos/home-l/llayer/cmsopen/columnar/utils.py\u001b[0m in \u001b[0;36mprint_yields\u001b[0;34m(path)\u001b[0m\n\u001b[1;32m    183\u001b[0m     \u001b[0;31m# Load df\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    184\u001b[0m     \u001b[0;31m# TO IMPLEMENT\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 185\u001b[0;31m     \u001b[0mdf\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mpd\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mread_hdf\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    186\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    187\u001b[0m     \u001b[0mdf_data\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"tau_requirement_w\"\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0misna\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/cvmfs/sft.cern.ch/lcg/views/LCG_97apython3/x86_64-centos7-gcc8-opt/lib/python3.7/site-packages/pandas/io/pytables.py\u001b[0m in \u001b[0;36mread_hdf\u001b[0;34m(path_or_buf, key, mode, **kwargs)\u001b[0m\n\u001b[1;32m    353\u001b[0m         \u001b[0mpath_or_buf\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0m_stringify_path\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath_or_buf\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    354\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0misinstance\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath_or_buf\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mstring_types\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 355\u001b[0;31m             raise NotImplementedError('Support for generic buffers has not '\n\u001b[0m\u001b[1;32m    356\u001b[0m                                       'been implemented.')\n\u001b[1;32m    357\u001b[0m         \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mNotImplementedError\u001b[0m: Support for generic buffers has not been implemented."
     ]
    }
   ],
   "source": [
    "importlib.reload(utils)\n",
    "utils.print_yields(cut_flow)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "limiting-earth",
   "metadata": {},
   "outputs": [],
   "source": [
    "def rearrange_samples(samples):\n",
    "    \n",
    "    # Concat and split MC in signal and background\n",
    "    new_samples = {}\n",
    "    new_samples[\"TTJets_signal\"] = samples[\"TTJets\"][samples[\"TTJets\"][\"isSignal\"] == True]\n",
    "    new_samples[\"TTJets_bkg\"] = samples[\"TTJets\"][samples[\"TTJets\"][\"isBkg\"] == True]\n",
    "    new_samples[\"WZJets\"] = pd.concat([samples['WJetsToLNu'], samples['DYJetsToLL']], axis=0)\n",
    "    new_samples[\"STJets\"] = pd.concat([samples['T_TuneZ2_s'], samples['T_TuneZ2_tW'], samples['T_TuneZ2_t-channel'], \n",
    "                              samples['Tbar_TuneZ2_s'], samples['Tbar_TuneZ2_tW'], \n",
    "                              samples['Tbar_TuneZ2_t-channel']], axis=0)\n",
    "\n",
    "    # Concat the data\n",
    "    new_samples[\"Data\"] = pd.concat([samples[\"Run2011A_MultiJet\"], samples[\"Run2011B_MultiJet\"]], axis=0)\n",
    "    new_samples[\"QCD\"] = pd.concat([samples[\"Run2011A_MultiJet_QCD\"], samples[\"Run2011B_MultiJet_QCD\"]], axis=0)\n",
    "    \n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "greatest-jewel",
   "metadata": {},
   "outputs": [],
   "source": [
    "new_samples = rearrange_samples(samples)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "departmental-berlin",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "dict_keys(['TTJets_signal', 'TTJets_bkg', 'WZJets', 'STJets', 'Data', 'QCD'])"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "new_samples.keys()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "covered-installation",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ml"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "id": "partial-jacob",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0        120.194692\n",
       "1        143.947763\n",
       "2        136.312132\n",
       "3         56.325748\n",
       "4        186.922750\n",
       "5         61.056529\n",
       "6         46.972774\n",
       "7         91.466774\n",
       "8        108.093581\n",
       "9        132.757056\n",
       "10        97.517267\n",
       "11        26.547727\n",
       "12        73.066498\n",
       "13        58.715191\n",
       "14        90.185948\n",
       "15        69.378767\n",
       "16        81.878050\n",
       "17        59.532468\n",
       "18        69.160082\n",
       "19       177.344680\n",
       "20       126.287493\n",
       "21        97.633149\n",
       "22       259.243552\n",
       "23       166.495940\n",
       "24       142.798862\n",
       "25       148.928310\n",
       "26        39.744702\n",
       "27       133.647733\n",
       "28        92.520899\n",
       "29       217.377274\n",
       "            ...    \n",
       "43540     59.369919\n",
       "43541     84.117038\n",
       "43542     50.525187\n",
       "43543    121.240753\n",
       "43544     46.319268\n",
       "43545    109.874231\n",
       "43546     43.848956\n",
       "43547     37.922905\n",
       "43548     81.799045\n",
       "43549     74.257965\n",
       "43550     57.423705\n",
       "43551    149.287938\n",
       "43552    145.672079\n",
       "43553    117.630608\n",
       "43554     53.910786\n",
       "43555     34.475510\n",
       "43556    252.738748\n",
       "43557     92.279322\n",
       "43558     87.509669\n",
       "43559    137.848312\n",
       "43560     44.383424\n",
       "43561     88.148211\n",
       "43562     77.120753\n",
       "43563     52.836685\n",
       "43564    114.532521\n",
       "43565     86.944997\n",
       "43566     78.446850\n",
       "43567     43.084267\n",
       "43568    182.012304\n",
       "43569    116.524137\n",
       "Name: MET_met, Length: 43570, dtype: float64"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "new_samples[\"TTJets_signal\"][\"MET_met\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "israeli-corps",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Set random state\n",
      "Prepare training data\n",
      "['Jet_pt', 'Jet_px', 'Jet_py', 'Jet_pz', 'Jet_e', 'Jet_eta', 'Jet_phi', 'Jet_mass', 'Jet_csvDisc', 'Jet_flavour', 'Tau_pt', 'Tau_px', 'Tau_py', 'Tau_pz', 'Tau_charge', 'Tau_e', 'Tau_eta', 'Tau_phi', 'Tau_mass', 'MET_pt', 'MET_px', 'MET_py', 'MET_pz', 'MET_e', 'MET_met', 'event', 'run', 'luminosityBlock', 'HLT_QuadJet40_IsoPFTau40', 'HLT_QuadJet45_IsoPFTau45', 'PV_npvs', 'genEvent_tmeme', 'norm', 'norm_up', 'norm_down', 'trigger_weight', 'trigger_weight_up', 'trigger_weight_down', 'trigger_is40', 'isSignal', 'isBkg', 'btag_weight1', 'btag_weight1_up', 'btag_weight1_down', 'btag_weight2', 'btag_weight2_up', 'btag_weight2_down', 'pdf', 'pdf_up', 'pdf_down', 'h', 'ht', 'h_jet', 'ht_jet', 'chargeEta', 'met', 'mTauJet', 'mt', 'deltaPhiTauMet', 'nJets', 'aplanarity', 'sphericity', 'train_flag', 'label', 'bdt', 'weight']\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:69: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df['train_flag'] = np.select(cond, choice)\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:87: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal[\"label\"] = 0\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:91: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal_train[\"weights\"] = signal_train['trigger_weight'] * signal_train['btag_weight1']\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:92: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal_train[\"weights\"] = signal_train[\"weights\"] * (1. / np.mean(signal_train[\"weights\"]))\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:95: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  bkg_train[\"weights\"] = bkg_train['btag_weight2']\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:96: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  bkg_train[\"weights\"] = bkg_train[\"weights\"] * (1. / np.mean(bkg_train[\"weights\"]))\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:99: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version\n",
      "of pandas will change to not sort by default.\n",
      "\n",
      "To accept the future behavior, pass 'sort=False'.\n",
      "\n",
      "To retain the current behavior and silence the warning, pass 'sort=True'.\n",
      "\n",
      "  train_data = pd.concat([signal_train, bkg_train], axis=0)\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:100: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version\n",
      "of pandas will change to not sort by default.\n",
      "\n",
      "To accept the future behavior, pass 'sort=False'.\n",
      "\n",
      "To retain the current behavior and silence the warning, pass 'sort=True'.\n",
      "\n",
      "  test_data = pd.concat([signal_test, bkg_test], axis=0)\n",
      "/cvmfs/sft.cern.ch/lcg/views/LCG_97apython3/x86_64-centos7-gcc8-opt/lib/python3.7/site-packages/xgboost/core.py:587: FutureWarning: Series.base is deprecated and will be removed in a future version\n",
      "  if getattr(data, 'base', None) is not None and \\\n",
      "/cvmfs/sft.cern.ch/lcg/views/LCG_97apython3/x86_64-centos7-gcc8-opt/lib/python3.7/site-packages/xgboost/core.py:588: FutureWarning: Series.base is deprecated and will be removed in a future version\n",
      "  data.base is not None and isinstance(data, np.ndarray) \\\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Train model\n",
      "Predicting...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:151: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  \n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "importlib.reload(ml)\n",
    "ml.train(new_samples, \".\", n_sig=5000, n_bkg=5000, ntrees=1000, lr=0.01)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "hydraulic-resource",
   "metadata": {},
   "outputs": [],
   "source": [
    "import plot"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "fifteen-template",
   "metadata": {},
   "outputs": [],
   "source": [
    "variables = [\n",
    "    {\"var_name\" : \"bdt\", \"bins\" : 20, \"xlow\" : 0., \"xup\" : 1., \"xtitle\" : \"bdt\"}\n",
    "]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "dated-blame",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TTJets_signal bdt None\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/plot.py:45: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  sample['weight'] = sample['norm'] * sample['trigger_weight'] * sample['btag_weight1']\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "RENORM TEMPLATE\n",
      "1.12869687015016 348.4666373400386 348.4666373400386\n",
      "TTJets_bkg bdt None\n",
      "WZJets bdt None\n",
      "STJets bdt None\n",
      "Data bdt None\n",
      "QCD bdt None\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/plot.py:30: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  sample['weight'] = sample['btag_weight2'] * scale_qcd\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(plot)\n",
    "plot.vars_to_histos(new_samples, variables, \"histos.root\", syst=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 106,
   "id": "decimal-cholesterol",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ROOT"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "id": "solid-gamma",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TFile**\t\thistos.root\t\n",
      " TFile*\t\thistos.root\t\n",
      "  KEY: TH1D\tTTJets_signal_bdt;1\tTTJets_signal_bdt\n",
      "  KEY: TH1D\tTTJets_bkg_bdt;1\tTTJets_bkg_bdt\n",
      "  KEY: TH1D\tWZJets_bdt;1\tWZJets_bdt\n",
      "  KEY: TH1D\tSTJets_bdt;1\tSTJets_bdt\n",
      "  KEY: TH1D\tData_bdt;1\tData_bdt\n",
      "  KEY: TH1D\tQCD_bdt;1\tQCD_bdt\n"
     ]
    }
   ],
   "source": [
    "f = ROOT.TFile(\"histos.root\")\n",
    "f.ls()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 108,
   "id": "worth-domain",
   "metadata": {},
   "outputs": [],
   "source": [
    "import fit"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "particular-steam",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Data_bdt\n",
      "Data 3323.0\n",
      "TTJets_bkg 134.02305321634543\n",
      "WZJets 63.63409761653705\n",
      "STJets 30.263673621567058\n",
      "QCD_bdt\n",
      "QCD 2689.5053333309666\n",
      "TTJets_signal 348.46663734003823\n",
      "scale factor TTbar tau(h) QQ  0.9406445436483206 +- 0.07901935844875005\n",
      "scale factor MultiJet  1.0289237579093604 +- 0.0102381689979027\n",
      "[#1] INFO:DataHandling -- RooDataHist::adjustBinning(signal): fit range of variable x expanded to nearest bin boundaries: [0,350] --> [0,1]\n",
      "[#0] WARNING:InputArguments -- RooAbsPdf::fitTo(pdf) WARNING: a likelihood fit is requested of what appears to be weighted data.\n",
      "       While the estimated values of the parameters will always be calculated taking the weights into account,\n",
      "       there are multiple ways to estimate the errors of the parameters. You are advised to make an \n",
      "       explicit choice for the error calculation:\n",
      "           - Either provide SumW2Error(true), to calculate a sum-of-weights-corrected HESSE error matrix\n",
      "             (error will be proportional to the number of events in MC).\n",
      "           - Or provide SumW2Error(false), to return errors from original HESSE error matrix\n",
      "             (which will be proportional to the sum of the weights, i.e., a dataset with <sum of weights> events).\n",
      "           - Or provide AsymptoticError(true), to use the asymptotically correct expression\n",
      "             (for details see https://arxiv.org/abs/1911.01303).\n",
      "[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization\n",
      "[#1] INFO:Minization --  The following expressions have been identified as constant and will be precalculated and cached: (signal,bkg)\n",
      " **********\n",
      " **   64 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   65 **SET NOGRAD\n",
      " **********\n",
      " PARAMETER DEFINITIONS:\n",
      "    NO.   NAME         VALUE      STEP SIZE      LIMITS\n",
      "     1 c0           5.00000e-01  1.00000e-01    0.00000e+00  1.00000e+00\n",
      " **********\n",
      " **   66 **SET ERR         0.5\n",
      " **********\n",
      " **********\n",
      " **   67 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   68 **SET STR           1\n",
      " **********\n",
      " NOW USING STRATEGY  1: TRY TO BALANCE SPEED AGAINST RELIABILITY\n",
      " **********\n",
      " **   69 **MIGRAD         500           1\n",
      " **********\n",
      " FIRST CALL TO USER FUNCTION AT NEW START POINT, WITH IFLAG=4.\n",
      " START MIGRAD MINIMIZATION.  STRATEGY  1.  CONVERGENCE WHEN EDM .LT. 1.00e-03\n",
      " FCN=-313.929 FROM MIGRAD    STATUS=INITIATE        4 CALLS           5 TOTAL\n",
      "                     EDM= unknown      STRATEGY= 1      NO ERROR MATRIX       \n",
      "  EXT PARAMETER               CURRENT GUESS       STEP         FIRST   \n",
      "  NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE \n",
      "   1  c0           5.00000e-01   1.00000e-01   2.01358e-01   1.27581e+03\n",
      "                               ERR DEF= 0.5\n",
      " MIGRAD MINIMIZATION HAS CONVERGED.\n",
      " MIGRAD WILL VERIFY CONVERGENCE AND ERROR MATRIX.\n",
      " COVARIANCE MATRIX CALCULATED SUCCESSFULLY\n",
      " FCN=-868.9 FROM MIGRAD    STATUS=CONVERGED      17 CALLS          18 TOTAL\n",
      "                     EDM=8.81167e-05    STRATEGY= 1      ERROR MATRIX ACCURATE \n",
      "  EXT PARAMETER                                   STEP         FIRST   \n",
      "  NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE \n",
      "   1  c0           1.05905e-01   8.89658e-03   5.80397e-04   3.24635e-01\n",
      "                               ERR DEF= 0.5\n",
      " EXTERNAL ERROR MATRIX.    NDIM=  25    NPAR=  1    ERR DEF=0.5\n",
      "  7.917e-05 \n",
      " **********\n",
      " **   70 **SET ERR         0.5\n",
      " **********\n",
      " **********\n",
      " **   71 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   72 **HESSE         500\n",
      " **********\n",
      " COVARIANCE MATRIX CALCULATED SUCCESSFULLY\n",
      " FCN=-868.9 FROM HESSE     STATUS=OK              5 CALLS          23 TOTAL\n",
      "                     EDM=8.81157e-05    STRATEGY= 1      ERROR MATRIX ACCURATE \n",
      "  EXT PARAMETER                                INTERNAL      INTERNAL  \n",
      "  NO.   NAME      VALUE            ERROR       STEP SIZE       VALUE   \n",
      "   1  c0           1.05905e-01   8.89658e-03   1.16079e-04  -9.07864e-01\n",
      "                               ERR DEF= 0.5\n",
      " EXTERNAL ERROR MATRIX.    NDIM=  25    NPAR=  1    ERR DEF=0.5\n",
      "  7.917e-05 \n",
      "[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(fit)\n",
    "\n",
    "sample_names = [\"Data\", \"TTJets_bkg\", \"WZJets\", \"STJets\", \"QCD\", \"TTJets_signal\"]\n",
    "sf_tt_sig, sf_qcd = fit.fit(\"histos.root\", sample_names, \"bdt\", corr=\"centJER\")\n",
    "sfs = {}\n",
    "sfs[\"TTJets_signal\"] = sf_tt_sig\n",
    "sfs[\"QCD\"] = sf_qcd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "viral-restoration",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "standing-phoenix",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 87,
   "id": "enormous-domain",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "from coffea.lookup_tools import extractor\n",
    "ext_trig = extractor()\n",
    "\"\"\"\n",
    "ext_trig.add_weight_sets([\n",
    "    \"jet40_ * rootFilesTurnOn/TriggerEffHisto_data_match40_JETLEG.root\",\n",
    "    \"jet45_ * rootFilesTurnOn/TriggerEffHisto_data_match45_JETLEG.root\",\n",
    "    \"tau40_ * rootFilesTurnOn/TriggerEffHisto_match40_newTauID.root\",\n",
    "    \"tau45_ * rootFilesTurnOn/TriggerEffHisto_match45_newTauID.root\"\n",
    "])\n",
    "\"\"\"\n",
    "\n",
    "ext_trig.add_weight_sets([\n",
    "    \"* * data/trigger_eff.root\"\n",
    "])\n",
    "\n",
    "ext_trig.finalize()\n",
    "\n",
    "evaluator_trig = ext_trig.make_evaluator()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "id": "turkish-blackberry",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "dict_keys(['jet4_eff_40', 'jet4_eff_40_error', 'jet4_eff_45', 'jet4_eff_45_error', 'tau_eff_40', 'tau_eff_40_error', 'tau_eff_45', 'tau_eff_45_error'])"
      ]
     },
     "execution_count": 88,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "evaluator_trig.keys()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "controlling-balance",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "cooperative-expense",
   "metadata": {},
   "outputs": [],
   "source": [
    "importlib.reload(btag)\n",
    "importlib.reload(weights)\n",
    "\n",
    "def candidates(sample, df, invert_btag = False, njets=-1):\n",
    "    \n",
    "    if \"Run2011\" in sample: isData = True\n",
    "    else: isData = False\n",
    "\n",
    "    print( \"Processing:\", sample,\"isData:\", isData, \"invert_btag:\", invert_btag)\n",
    "\n",
    "    df['nJets'] = df[\"Jet_pt\"].str.len()\n",
    "    \n",
    "    # b-tagging\n",
    "    df[\"Jet_nbtags\"] = df[\"Jet_csvDisc\"].apply( lambda x : btag.count_btags(x, njets=njets) )\n",
    "    if invert_btag:\n",
    "        df = btag.no_tag(df)\n",
    "    else:\n",
    "        df = btag.at_least_1tag(df)\n",
    "\n",
    "    # MET cut\n",
    "    df = selection.met_requirement(df)\n",
    "\n",
    "    \n",
    "    # HL features\n",
    "    #df = pd.concat([df, df.apply(lambda ev : pd.Series(hl.hlFeatures(ev, njets=njets)), axis=1)], axis=1)\n",
    "    \n",
    "\n",
    "    # MC weights\n",
    "    if not isData:\n",
    "\n",
    "        hlt_40, hlt_45 = weights.lumi()\n",
    "        total_lumi = hlt_40 + hlt_45\n",
    "        trigger_frac = hlt_40 / float(hlt_45)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(btag.eval_sf_eff(ev)), axis=1)], axis=1)\n",
    "        df[\"Jet_btag_weight1\"] = df.apply(lambda ev : btag.b_weight_method1(ev, njets=njets), axis=1)\n",
    "        #df[\"Jet_btag_weight2\"] = df.apply(lambda ev : btag.b_weight_method2(ev, njets=njets), axis=1)\n",
    "        # trigger weights\n",
    "        #df[\"trigger_weight\"] = df.apply(lambda ev : weights.trigger_weight(ev, trigger_frac), axis=1)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(weights.trigger_weight(ev, trigger_frac)), axis=1)], axis=1)\n",
    "        # normalization\n",
    "        counts_path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + sample + \"_counts.root\"\n",
    "        total_counts = root_pandas.read_root(counts_path)\n",
    "        xsec = weights.get_xsec(sample)\n",
    "        weights.norm(df, total_counts, xsec, lumi = total_lumi)\n",
    "\n",
    "    # QCD\n",
    "    if isData & invert_btag:\n",
    "        \n",
    "        # Assume light flavour\n",
    "        def lf(nJets):\n",
    "            return np.zeros((nJets))\n",
    "        df[\"Jet_flavour\"] = df[\"nJets\"].apply(lf)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(btag.eval_sf_eff(ev)), axis=1)], axis=1)\n",
    "        df[\"btag_weight\"] = df.apply(lambda ev : btag.b_weight_method2(ev, njets=njets), axis=1)\n",
    "        \n",
    "    return df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "spatial-southeast",
   "metadata": {},
   "outputs": [],
   "source": [
    "def rearrange_samples(samples):\n",
    "    \n",
    "    # Concat and split MC in signal and background\n",
    "    new_samples = {}\n",
    "    new_samples[\"TTJets_signal\"], new_samples[\"TTJets_bkg\"] = weights.classify_tt(samples[\"TTJets\"])\n",
    "    new_samples[\"WZJets\"] = pd.concat([samples['WJetsToLNu'], samples['DYJetsToLL']], axis=0)\n",
    "    new_samples[\"STJets\"] = pd.concat([samples['T_TuneZ2_s'], samples['T_TuneZ2_tW'], samples['T_TuneZ2_t-channel'], \n",
    "                              samples['Tbar_TuneZ2_s'], samples['Tbar_TuneZ2_tW'], \n",
    "                              samples['Tbar_TuneZ2_t-channel']], axis=0)\n",
    "\n",
    "    # Concat the data\n",
    "    new_samples[\"Data\"] = pd.concat([samples[\"Run2011A_MultiJet\"], samples[\"Run2011B_MultiJet\"]], axis=0)\n",
    "    new_samples[\"QCD\"] = pd.concat([samples[\"QCD_Run2011A_MultiJet\"], samples[\"QCD_Run2011B_MultiJet\"]], axis=0)\n",
    "    \n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "unable-prisoner",
   "metadata": {},
   "outputs": [],
   "source": [
    "def proc_candidates(samples, njets = -1):\n",
    "    \n",
    "    cand_samples = {}\n",
    "    for sample in data:\n",
    "        cand_samples[sample] = candidates(sample, samples[sample], invert_btag = False, njets=njets)\n",
    "        cand_samples[\"QCD_\" + sample] = candidates(sample, samples[sample], invert_btag = True, njets=njets)\n",
    "    \n",
    "    \n",
    "    for sample in mc:\n",
    "        cand_samples[sample] = candidates(sample, samples[sample], invert_btag = False, njets=njets)   \n",
    "\n",
    "    new_samples = rearrange_samples(cand_samples)\n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "environmental-driver",
   "metadata": {},
   "outputs": [],
   "source": [
    "cands = proc_candidates(samples)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "literary-episode",
   "metadata": {},
   "outputs": [],
   "source": [
    "len(cands[\"Data\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "atomic-sullivan",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ROOT\n",
    "from root_numpy import fill_hist\n",
    "\n",
    "def save_var(sample, name, var_name, bins = 20, xlow = 0., xup = 350):\n",
    "\n",
    "    hist = ROOT.TH1D(name + \"_\" + var_name, name + \"_\" + var_name, bins, xlow, xup)\n",
    "    hist.Sumw2()\n",
    "    \n",
    "    if name == \"Data\":\n",
    "        pass\n",
    "    elif name == \"QCD\":\n",
    "        if var_name == \"bdt\":\n",
    "            scale_qcd = 9.\n",
    "            sample = sample[sample[\"train_flag\"] == \"test\"]\n",
    "        else:\n",
    "            scale_qcd = 4.3\n",
    "        sample['weight'] = sample['btag_weight'] * scale_qcd\n",
    "    else:\n",
    "        #samples[sample]['new_trigger_weight'] = new_samples[sample].apply(lambda ev : weights.trigger_weight(ev), axis=1)\n",
    "        sample['weight'] = sample['norm'] * (1/1000) * sample['trigger_weight'] * sample['Jet_btag_weight1']\n",
    "        #print(sample, sum(samples[sample]['weight']))\n",
    "        #new_samples[sample]['btag_weight2']\n",
    "    \n",
    "    # Flatten if the column is a list\n",
    "    if \"Jet_\" in var_name:\n",
    "        series = sample[var_name].apply(pd.Series).stack().reset_index(drop=True)\n",
    "        if name != \"Data\":\n",
    "            sample['weight_stacked'] = sample.apply(lambda x : stack_weight(x[\"weight\"] ,x[\"nJets\"]), axis=1)\n",
    "            weights = sample['weight_stacked'].apply(pd.Series).stack().reset_index(drop=True)\n",
    "    else:\n",
    "        series = sample[var_name]\n",
    "        if name != \"Data\":\n",
    "            weights = sample[\"weight\"]\n",
    "    if name == \"Data\":\n",
    "        fill_hist(hist, series)\n",
    "    else:\n",
    "        fill_hist(hist, series, weights = weights)\n",
    "    #hist.Write()\n",
    "    return hist\n",
    "\n",
    "def vars_to_histos(samples, variables):\n",
    "    \n",
    "    hists = {}\n",
    "    for name, sample in samples.items():\n",
    "        for var in variables:\n",
    "            hists[name + \"_\" + var[\"var_name\"]] = save_var(sample, name, var[\"var_name\"], var[\"bins\"], var[\"xlow\"], var[\"xup\"])\n",
    "\n",
    "    return hists"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "moral-south",
   "metadata": {},
   "outputs": [],
   "source": [
    "variables = [\n",
    "    {\"var_name\" : \"MET_met\", \"bins\" : 30, \"xlow\" : 0., \"xup\" : 400, \"xtitle\" : \"MET [GeV]\"}\n",
    "]\n",
    "\n",
    "hists = vars_to_histos(cands, variables)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fixed-ozone",
   "metadata": {},
   "outputs": [],
   "source": [
    "f = ROOT.TFile(\"histos_test.root\", \"RECREATE\")\n",
    "for s, hist in hists.items():\n",
    "\n",
    "    print( s, hist.Integral() )\n",
    "    hist.Write()\n",
    "    \n",
    "f.Close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "prompt-hypothesis",
   "metadata": {},
   "outputs": [],
   "source": [
    "def fit(histos, fit_var, corr = \"central\"):\n",
    "        \n",
    "\n",
    "    bkg = histos['TTJets_bkg' + \"_\" + fit_var ].Clone()\n",
    "    bkg.Add(histos['WZJets' + \"_\" + fit_var ])\n",
    "    bkg.Add(histos['STJets' + \"_\" + fit_var ])\n",
    "\n",
    "    data = histos[\"Data\" + \"_\" + fit_var ].Clone()\n",
    "    data.Add(bkg, -1.)\n",
    "\n",
    "    signal = histos[\"TTJets_signal\" + \"_\" + fit_var ]\n",
    "\n",
    "    qcd = histos[\"QCD\" + \"_\" + fit_var ]\n",
    "\n",
    "    x = ROOT.RooRealVar(\"x\",\"x\",0.,350.)\n",
    "    rooSignal =  ROOT.RooDataHist(\"signal\",\"signal\",ROOT.RooArgList( x ), signal)\n",
    "    rooBkg = ROOT.RooDataHist(\"bkg\",\"bkg\", ROOT.RooArgList( x ), qcd)\n",
    "    signal_pdf = ROOT.RooHistPdf(\"signal\",\"signal\",ROOT.RooArgSet( x ), rooSignal)\n",
    "    bkg_pdf = ROOT.RooHistPdf(\"bkg\",\"bkg\",ROOT.RooArgSet( x ), rooBkg)\n",
    "\n",
    "    c0 = ROOT.RooRealVar(\"c0\",\"c0\",0.5,0.,1.)\n",
    "    pdf = ROOT.RooAddPdf(\"pdf\",\"pdf\", signal_pdf,bkg_pdf, c0)\n",
    "\n",
    "    dataFit = ROOT.RooDataHist(\"data\",\"data\",ROOT.RooArgList( x ), data);\n",
    "\n",
    "    fitResult = pdf.fitTo(dataFit)\n",
    "    #print( fitResult )\n",
    "\n",
    "    sf_tt_sig = (c0.getVal() * data.Integral()) / signal.Integral() \n",
    "    sf_tt_sig_err = (c0.getError() * data.Integral()) / signal.Integral()\n",
    "    \n",
    "    sf_qcd = ((1-c0.getVal())*data.Integral()) / qcd.Integral()\n",
    "    sf_qcd_err = (c0.getError() * data.Integral()) / qcd.Integral()\n",
    "    \n",
    "    \n",
    "    print( \"scale factor TTbar tau(h) QQ \", sf_tt_sig, \"+-\", sf_tt_sig_err )\n",
    "    print( \"scale factor MultiJet \", sf_qcd, \"+-\", sf_qcd_err )\n",
    "\n",
    "    return sf_tt_sig, sf_qcd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "neural-rover",
   "metadata": {},
   "outputs": [],
   "source": [
    "fit(hists, \"MET_met\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "available-typing",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
