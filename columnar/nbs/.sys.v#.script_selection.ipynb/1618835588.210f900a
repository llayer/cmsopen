{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "latin-knight",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Welcome to JupyROOT 6.20/06\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import selection\n",
    "import weights\n",
    "import btag\n",
    "import root_pandas\n",
    "import importlib\n",
    "import jetmet\n",
    "import test_weights\n",
    "import object_selection"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "id": "upper-stranger",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processing: T_TuneZ2_s isData: False isTT: True corrLevel cent invert_btag False\n",
      "(30, 10) (30, 4)\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(selection)\n",
    "importlib.reload(jetmet)\n",
    "importlib.reload(test_weights)\n",
    "importlib.reload(object_selection)\n",
    "path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + \"T_TuneZ2_s\" + \".root\"\n",
    "df, jet, tau, cut_flow = selection.event_selection(path, isData = False, isTT = True  )#, corrLevel = \"centJER\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "explicit-christmas",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "coastal-paintball",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 96,
   "id": "designing-worker",
   "metadata": {},
   "outputs": [],
   "source": [
    "data = ['Run2011A_MultiJet', 'Run2011B_MultiJet']\n",
    "mc = ['T_TuneZ2_s', 'WJetsToLNu', 'DYJetsToLL', 'T_TuneZ2_tW', 'T_TuneZ2_t-channel',\n",
    "       'Tbar_TuneZ2_s', 'Tbar_TuneZ2_tW', 'Tbar_TuneZ2_t-channel', 'TTJets']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "id": "weighted-outdoors",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processing: T_TuneZ2_s isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(30, 9) (30, 4)\n",
      "Processing: WJetsToLNu isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(254, 9) (254, 4)\n",
      "Processing: DYJetsToLL isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(728, 9) (728, 4)\n",
      "Processing: T_TuneZ2_tW isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(632, 9) (632, 4)\n",
      "Processing: T_TuneZ2_t-channel isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(251, 9) (251, 4)\n",
      "Processing: Tbar_TuneZ2_s isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(15, 9) (15, 4)\n",
      "Processing: Tbar_TuneZ2_tW isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(713, 9) (713, 4)\n",
      "Processing: Tbar_TuneZ2_t-channel isData: False isTT: False corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(150, 9) (150, 4)\n",
      "Processing: TTJets isData: False isTT: True corrLevel centJER invert_btag False\n",
      "SF 1.0 1.0\n",
      "(98977, 10) (98977, 4)\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/test_weights.py:95: RuntimeWarning: invalid value encountered in true_divide\n",
      "  weights = pd.DataFrame({\"btag_weight1\" : pdata/pmc, \"btag_weight1_up\" : pdata_up/pmc,\n",
      "/eos/home-l/llayer/cmsopen/columnar/test_weights.py:96: RuntimeWarning: invalid value encountered in true_divide\n",
      "  \"btag_weight1_down\" : pdata_down/pmc})\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Processing: Run2011A_MultiJet isData: True isTT: False corrLevel cent invert_btag False\n",
      "Processing: Run2011A_MultiJet isData: True isTT: False corrLevel cent invert_btag True\n",
      "Processing: Run2011B_MultiJet isData: True isTT: False corrLevel cent invert_btag False\n",
      "Processing: Run2011B_MultiJet isData: True isTT: False corrLevel cent invert_btag True\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(selection)\n",
    "importlib.reload(jetmet)\n",
    "importlib.reload(test_weights)\n",
    "importlib.reload(object_selection)\n",
    "def event_selection():\n",
    "    \n",
    "    samples = {}\n",
    "    cut_flow = []\n",
    "    cut_flow_normed = {}\n",
    "    \n",
    "    for sample in mc + data:\n",
    "        \n",
    "        #!!!!!!! Careful with JER application before Tau?!\n",
    "        \n",
    "        if \"TTJets\" in sample: isTT = True\n",
    "        else: isTT = False\n",
    "            \n",
    "        if \"Run2011\" in sample: isData = True\n",
    "        else: isData = False\n",
    "        \n",
    "        path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + sample + \".root\"\n",
    "        \n",
    "        if isData:\n",
    "            for inv_btag, suffix in zip([False, True], [\"\", \"_QCD\"]):\n",
    "                \n",
    "                df, _, _, ev_count = selection.event_selection(path, isData = isData, isTT = isTT, \n",
    "                                                                          invert_btag = inv_btag)\n",
    "                samples[sample + suffix] = df\n",
    "                ev_count[\"sample\"] = sample + suffix\n",
    "                cut_flow.append(ev_count)\n",
    "        else:\n",
    "            df, _, _, ev_count = selection.event_selection(path, isData = isData, isTT = isTT, corrLevel=\"centJER\")\n",
    "            samples[sample] = df\n",
    "            ev_count[\"sample\"] = sample\n",
    "            cut_flow.append(ev_count)\n",
    "\n",
    "        #print( cut_flow )        \n",
    "        \n",
    "    return samples, cut_flow\n",
    "\n",
    "samples, cut_flow = event_selection()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "id": "operational-anchor",
   "metadata": {},
   "outputs": [],
   "source": [
    "import utils"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "id": "personalized-utility",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/utils.py:195: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df_mc[cut[:-2]] = df_mc.apply(lambda row : format_yield(row[cut], row[cut + \"_err\"]), axis=1)\n",
      "/eos/home-l/llayer/cmsopen/columnar/utils.py:196: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df_tt_sig[cut[:-2]] = df_tt_sig.apply(lambda row : format_yield(row[cut + \"_sig\"], row[cut + \"_err_sig\"]), axis=1)\n",
      "/eos/home-l/llayer/cmsopen/columnar/utils.py:197: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df_tt_bkg[cut[:-2]] = df_tt_sig.apply(lambda row : format_yield(row[cut + \"_bkg\"], row[cut + \"_err_bkg\"]), axis=1)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\\begin{tabular}{lllll}\n",
      "\\toprule\n",
      "Cut &  Run A &  Run B & $\\mathrm{t} \\overline{\\mathrm{t}}\\rightarrow \\tau_{h}+$jets & $\\mathrm{t} \\overline{\\mathrm{t}}\\rightarrow \\mathrm{X}$ \\\\\n",
      "\\midrule\n",
      "4 jets $+\\tau_{h}$               &  14408 &  10394 &                                    456.9 $\\pm$ 2.0 &                                    336.0 $\\pm$ 1.7 \\\\\n",
      "$\\mathrm{e}, \\mu$ veto           &  14196 &  10246 &                                    449.5 $\\pm$ 1.9 &                                    249.9 $\\pm$ 1.4 \\\\\n",
      "$E_{\\mathrm{T}}^{\\mathrm{miss}}$ &   8025 &   6553 &                                    411.1 $\\pm$ 1.9 &                                    174.1 $\\pm$ 1.2 \\\\\n",
      "$\\geq 1 \\mathrm{btag}$           &   1856 &   1487 &                                    345.9 $\\pm$ 1.7 &                                    142.5 $\\pm$ 1.1 \\\\\n",
      "\\bottomrule\n",
      "\\end{tabular}\n",
      "\n",
      "\\begin{tabular}{lllll}\n",
      "\\toprule\n",
      "Cut &          W + jets &         Z + jets &        s-t (tW) & s-$\\overline{\\mathrm{t}}$ (tW) \\\\\n",
      "\\midrule\n",
      "4 jets $+\\tau_{h}$               &  282.1 $\\pm$ 18.0 &  161.9 $\\pm$ 6.1 &  18.0 $\\pm$ 0.7 &                 18.8 $\\pm$ 0.7 \\\\\n",
      "$\\mathrm{e}, \\mu$ veto           &  258.1 $\\pm$ 17.2 &  125.2 $\\pm$ 5.4 &  16.1 $\\pm$ 0.7 &                 17.0 $\\pm$ 0.7 \\\\\n",
      "$E_{\\mathrm{T}}^{\\mathrm{miss}}$ &  240.8 $\\pm$ 16.6 &   98.5 $\\pm$ 4.8 &  13.7 $\\pm$ 0.6 &                 14.6 $\\pm$ 0.6 \\\\\n",
      "$\\geq 1 \\mathrm{btag}$           &    43.7 $\\pm$ 6.9 &   19.7 $\\pm$ 2.1 &  10.4 $\\pm$ 0.6 &                 11.3 $\\pm$ 0.5 \\\\\n",
      "\\bottomrule\n",
      "\\end{tabular}\n",
      "\n",
      "\\begin{tabular}{lllll}\n",
      "\\toprule\n",
      "Cut &        s-t (t) & s-$\\overline{\\mathrm{t}}$ (t) &        s-t (s) & s-$\\overline{\\mathrm{t}}$ (s) \\\\\n",
      "\\midrule\n",
      "4 jets $+\\tau_{h}$               &  8.4 $\\pm$ 0.5 &                 4.5 $\\pm$ 0.4 &  1.0 $\\pm$ 0.2 &                 0.4 $\\pm$ 0.1 \\\\\n",
      "$\\mathrm{e}, \\mu$ veto           &  8.2 $\\pm$ 0.5 &                 4.3 $\\pm$ 0.4 &  1.0 $\\pm$ 0.2 &                 0.4 $\\pm$ 0.1 \\\\\n",
      "$E_{\\mathrm{T}}^{\\mathrm{miss}}$ &  5.5 $\\pm$ 0.4 &                 3.1 $\\pm$ 0.3 &  0.8 $\\pm$ 0.2 &                 0.3 $\\pm$ 0.1 \\\\\n",
      "$\\geq 1 \\mathrm{btag}$           &  4.8 $\\pm$ 0.4 &                 2.7 $\\pm$ 0.3 &  0.7 $\\pm$ 0.2 &                 0.2 $\\pm$ 0.1 \\\\\n",
      "\\bottomrule\n",
      "\\end{tabular}\n",
      "\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/utils.py:198: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df_tt_sig[\"sample\"]  = \"TTJets_sig\"\n",
      "/eos/home-l/llayer/cmsopen/columnar/utils.py:199: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df_tt_bkg[\"sample\"]  = \"TTJets_bkg\"\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(utils)\n",
    "utils.print_yields(cut_flow)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "id": "enabling-cornell",
   "metadata": {},
   "outputs": [],
   "source": [
    "def rearrange_samples(samples):\n",
    "    \n",
    "    # Concat and split MC in signal and background\n",
    "    new_samples = {}\n",
    "    new_samples[\"TTJets_signal\"] = samples[\"TTJets\"][samples[\"TTJets\"][\"isSignal\"] == True]\n",
    "    new_samples[\"TTJets_bkg\"] = samples[\"TTJets\"][samples[\"TTJets\"][\"isBkg\"] == True]\n",
    "    new_samples[\"WZJets\"] = pd.concat([samples['WJetsToLNu'], samples['DYJetsToLL']], axis=0)\n",
    "    new_samples[\"STJets\"] = pd.concat([samples['T_TuneZ2_s'], samples['T_TuneZ2_tW'], samples['T_TuneZ2_t-channel'], \n",
    "                              samples['Tbar_TuneZ2_s'], samples['Tbar_TuneZ2_tW'], \n",
    "                              samples['Tbar_TuneZ2_t-channel']], axis=0)\n",
    "\n",
    "    # Concat the data\n",
    "    new_samples[\"Data\"] = pd.concat([samples[\"Run2011A_MultiJet\"], samples[\"Run2011B_MultiJet\"]], axis=0)\n",
    "    new_samples[\"QCD\"] = pd.concat([samples[\"Run2011A_MultiJet_QCD\"], samples[\"Run2011B_MultiJet_QCD\"]], axis=0)\n",
    "    \n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "id": "successful-quantum",
   "metadata": {},
   "outputs": [],
   "source": [
    "new_samples = rearrange_samples(samples)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "id": "parental-external",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "dict_keys(['TTJets_signal', 'TTJets_bkg', 'WZJets', 'STJets', 'Data', 'QCD'])"
      ]
     },
     "execution_count": 100,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "new_samples.keys()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 101,
   "id": "editorial-massachusetts",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ml"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 102,
   "id": "nuclear-pacific",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Set random state\n",
      "Prepare training data\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:69: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  df['train_flag'] = np.select(cond, choice)\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:87: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal[\"label\"] = 0\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['Jet_pt', 'Jet_px', 'Jet_py', 'Jet_pz', 'Jet_e', 'Jet_eta', 'Jet_phi', 'Jet_mass', 'Jet_csvDisc', 'Jet_flavour', 'Tau_pt', 'Tau_px', 'Tau_py', 'Tau_pz', 'Tau_charge', 'Tau_e', 'Tau_eta', 'Tau_phi', 'Tau_mass', 'MET_pt', 'MET_px', 'MET_py', 'MET_pz', 'MET_e', 'MET_met', 'event', 'run', 'luminosityBlock', 'HLT_QuadJet40_IsoPFTau40', 'HLT_QuadJet45_IsoPFTau45', 'PV_npvs', 'genEvent_tmeme', 'norm', 'norm_up', 'norm_down', 'trigger_weight', 'trigger_weight_up', 'trigger_weight_down', 'trigger_is40', 'isSignal', 'isBkg', 'btag_weight1', 'btag_weight1_up', 'btag_weight1_down', 'btag_weight2', 'btag_weight2_up', 'btag_weight2_down', 'h', 'ht', 'h_jet', 'ht_jet', 'chargeEta', 'met', 'mTauJet', 'mt', 'deltaPhiTauMet', 'nJets', 'aplanarity', 'sphericity', 'train_flag']\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:91: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal_train[\"weights\"] = signal_train['trigger_weight'] * signal_train['btag_weight1']\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:92: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  signal_train[\"weights\"] = signal_train[\"weights\"] * (1. / np.mean(signal_train[\"weights\"]))\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:95: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  bkg_train[\"weights\"] = bkg_train['btag_weight2']\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:96: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  bkg_train[\"weights\"] = bkg_train[\"weights\"] * (1. / np.mean(bkg_train[\"weights\"]))\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:99: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version\n",
      "of pandas will change to not sort by default.\n",
      "\n",
      "To accept the future behavior, pass 'sort=False'.\n",
      "\n",
      "To retain the current behavior and silence the warning, pass 'sort=True'.\n",
      "\n",
      "  train_data = pd.concat([signal_train, bkg_train], axis=0)\n",
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:100: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version\n",
      "of pandas will change to not sort by default.\n",
      "\n",
      "To accept the future behavior, pass 'sort=False'.\n",
      "\n",
      "To retain the current behavior and silence the warning, pass 'sort=True'.\n",
      "\n",
      "  test_data = pd.concat([signal_test, bkg_test], axis=0)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Train model\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/cvmfs/sft.cern.ch/lcg/views/LCG_97apython3/x86_64-centos7-gcc8-opt/lib/python3.7/site-packages/xgboost/core.py:587: FutureWarning: Series.base is deprecated and will be removed in a future version\n",
      "  if getattr(data, 'base', None) is not None and \\\n",
      "/cvmfs/sft.cern.ch/lcg/views/LCG_97apython3/x86_64-centos7-gcc8-opt/lib/python3.7/site-packages/xgboost/core.py:588: FutureWarning: Series.base is deprecated and will be removed in a future version\n",
      "  data.base is not None and isinstance(data, np.ndarray) \\\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Predicting...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/ml.py:150: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  samples[sample][\"bdt\"] = bdt.predict_proba(samples[sample][features].values)[:,0]\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "importlib.reload(ml)\n",
    "ml.train(new_samples, \".\", n_sig=5000, n_bkg=5000, ntrees=500, lr=0.01, random_state=5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 103,
   "id": "corresponding-decline",
   "metadata": {},
   "outputs": [],
   "source": [
    "import plot"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 104,
   "id": "thermal-sister",
   "metadata": {},
   "outputs": [],
   "source": [
    "variables = [\n",
    "    {\"var_name\" : \"bdt\", \"bins\" : 20, \"xlow\" : 0., \"xup\" : 1., \"xtitle\" : \"bdt\"}\n",
    "]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 105,
   "id": "awful-concentration",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TTJets_signal bdt None\n",
      "RENORM TEMPLATE\n",
      "1.1295745343103505 348.46663734003823 348.4666373400383\n",
      "TTJets_bkg bdt None\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/eos/home-l/llayer/cmsopen/columnar/plot.py:45: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  sample['weight'] = sample['norm'] * sample['trigger_weight'] * sample['btag_weight1']\n",
      "/eos/home-l/llayer/cmsopen/columnar/plot.py:30: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  sample['weight'] = sample['btag_weight2'] * scale_qcd\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WZJets bdt None\n",
      "STJets bdt None\n",
      "Data bdt None\n",
      "QCD bdt None\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(plot)\n",
    "plot.vars_to_histos(new_samples, variables, \"histos.root\", syst=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 106,
   "id": "occasional-hindu",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ROOT"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "id": "contemporary-warning",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TFile**\t\thistos.root\t\n",
      " TFile*\t\thistos.root\t\n",
      "  KEY: TH1D\tTTJets_signal_bdt;1\tTTJets_signal_bdt\n",
      "  KEY: TH1D\tTTJets_bkg_bdt;1\tTTJets_bkg_bdt\n",
      "  KEY: TH1D\tWZJets_bdt;1\tWZJets_bdt\n",
      "  KEY: TH1D\tSTJets_bdt;1\tSTJets_bdt\n",
      "  KEY: TH1D\tData_bdt;1\tData_bdt\n",
      "  KEY: TH1D\tQCD_bdt;1\tQCD_bdt\n"
     ]
    }
   ],
   "source": [
    "f = ROOT.TFile(\"histos.root\")\n",
    "f.ls()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 108,
   "id": "cognitive-choir",
   "metadata": {},
   "outputs": [],
   "source": [
    "import fit"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "duplicate-seminar",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Data_bdt\n",
      "Data 3323.0\n",
      "TTJets_bkg 134.02305321634543\n",
      "WZJets 63.63409761653705\n",
      "STJets 30.263673621567058\n",
      "QCD_bdt\n",
      "QCD 2689.5053333309666\n",
      "TTJets_signal 348.46663734003823\n",
      "scale factor TTbar tau(h) QQ  0.9406445436483206 +- 0.07901935844875005\n",
      "scale factor MultiJet  1.0289237579093604 +- 0.0102381689979027\n",
      "[#1] INFO:DataHandling -- RooDataHist::adjustBinning(signal): fit range of variable x expanded to nearest bin boundaries: [0,350] --> [0,1]\n",
      "[#0] WARNING:InputArguments -- RooAbsPdf::fitTo(pdf) WARNING: a likelihood fit is requested of what appears to be weighted data.\n",
      "       While the estimated values of the parameters will always be calculated taking the weights into account,\n",
      "       there are multiple ways to estimate the errors of the parameters. You are advised to make an \n",
      "       explicit choice for the error calculation:\n",
      "           - Either provide SumW2Error(true), to calculate a sum-of-weights-corrected HESSE error matrix\n",
      "             (error will be proportional to the number of events in MC).\n",
      "           - Or provide SumW2Error(false), to return errors from original HESSE error matrix\n",
      "             (which will be proportional to the sum of the weights, i.e., a dataset with <sum of weights> events).\n",
      "           - Or provide AsymptoticError(true), to use the asymptotically correct expression\n",
      "             (for details see https://arxiv.org/abs/1911.01303).\n",
      "[#1] INFO:Minization -- RooMinimizer::optimizeConst: activating const optimization\n",
      "[#1] INFO:Minization --  The following expressions have been identified as constant and will be precalculated and cached: (signal,bkg)\n",
      " **********\n",
      " **   64 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   65 **SET NOGRAD\n",
      " **********\n",
      " PARAMETER DEFINITIONS:\n",
      "    NO.   NAME         VALUE      STEP SIZE      LIMITS\n",
      "     1 c0           5.00000e-01  1.00000e-01    0.00000e+00  1.00000e+00\n",
      " **********\n",
      " **   66 **SET ERR         0.5\n",
      " **********\n",
      " **********\n",
      " **   67 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   68 **SET STR           1\n",
      " **********\n",
      " NOW USING STRATEGY  1: TRY TO BALANCE SPEED AGAINST RELIABILITY\n",
      " **********\n",
      " **   69 **MIGRAD         500           1\n",
      " **********\n",
      " FIRST CALL TO USER FUNCTION AT NEW START POINT, WITH IFLAG=4.\n",
      " START MIGRAD MINIMIZATION.  STRATEGY  1.  CONVERGENCE WHEN EDM .LT. 1.00e-03\n",
      " FCN=-313.929 FROM MIGRAD    STATUS=INITIATE        4 CALLS           5 TOTAL\n",
      "                     EDM= unknown      STRATEGY= 1      NO ERROR MATRIX       \n",
      "  EXT PARAMETER               CURRENT GUESS       STEP         FIRST   \n",
      "  NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE \n",
      "   1  c0           5.00000e-01   1.00000e-01   2.01358e-01   1.27581e+03\n",
      "                               ERR DEF= 0.5\n",
      " MIGRAD MINIMIZATION HAS CONVERGED.\n",
      " MIGRAD WILL VERIFY CONVERGENCE AND ERROR MATRIX.\n",
      " COVARIANCE MATRIX CALCULATED SUCCESSFULLY\n",
      " FCN=-868.9 FROM MIGRAD    STATUS=CONVERGED      17 CALLS          18 TOTAL\n",
      "                     EDM=8.81167e-05    STRATEGY= 1      ERROR MATRIX ACCURATE \n",
      "  EXT PARAMETER                                   STEP         FIRST   \n",
      "  NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE \n",
      "   1  c0           1.05905e-01   8.89658e-03   5.80397e-04   3.24635e-01\n",
      "                               ERR DEF= 0.5\n",
      " EXTERNAL ERROR MATRIX.    NDIM=  25    NPAR=  1    ERR DEF=0.5\n",
      "  7.917e-05 \n",
      " **********\n",
      " **   70 **SET ERR         0.5\n",
      " **********\n",
      " **********\n",
      " **   71 **SET PRINT           1\n",
      " **********\n",
      " **********\n",
      " **   72 **HESSE         500\n",
      " **********\n",
      " COVARIANCE MATRIX CALCULATED SUCCESSFULLY\n",
      " FCN=-868.9 FROM HESSE     STATUS=OK              5 CALLS          23 TOTAL\n",
      "                     EDM=8.81157e-05    STRATEGY= 1      ERROR MATRIX ACCURATE \n",
      "  EXT PARAMETER                                INTERNAL      INTERNAL  \n",
      "  NO.   NAME      VALUE            ERROR       STEP SIZE       VALUE   \n",
      "   1  c0           1.05905e-01   8.89658e-03   1.16079e-04  -9.07864e-01\n",
      "                               ERR DEF= 0.5\n",
      " EXTERNAL ERROR MATRIX.    NDIM=  25    NPAR=  1    ERR DEF=0.5\n",
      "  7.917e-05 \n",
      "[#1] INFO:Minization -- RooMinimizer::optimizeConst: deactivating const optimization\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n",
      "Warning in <TH1D::Sumw2>: Sum of squares of weights structure already created\n"
     ]
    }
   ],
   "source": [
    "importlib.reload(fit)\n",
    "\n",
    "sample_names = [\"Data\", \"TTJets_bkg\", \"WZJets\", \"STJets\", \"QCD\", \"TTJets_signal\"]\n",
    "sf_tt_sig, sf_qcd = fit.fit(\"histos.root\", sample_names, \"bdt\", corr=\"centJER\")\n",
    "sfs = {}\n",
    "sfs[\"TTJets_signal\"] = sf_tt_sig\n",
    "sfs[\"QCD\"] = sf_qcd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "alternate-proportion",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "logical-storm",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 87,
   "id": "spoken-network",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "from coffea.lookup_tools import extractor\n",
    "ext_trig = extractor()\n",
    "\"\"\"\n",
    "ext_trig.add_weight_sets([\n",
    "    \"jet40_ * rootFilesTurnOn/TriggerEffHisto_data_match40_JETLEG.root\",\n",
    "    \"jet45_ * rootFilesTurnOn/TriggerEffHisto_data_match45_JETLEG.root\",\n",
    "    \"tau40_ * rootFilesTurnOn/TriggerEffHisto_match40_newTauID.root\",\n",
    "    \"tau45_ * rootFilesTurnOn/TriggerEffHisto_match45_newTauID.root\"\n",
    "])\n",
    "\"\"\"\n",
    "\n",
    "ext_trig.add_weight_sets([\n",
    "    \"* * data/trigger_eff.root\"\n",
    "])\n",
    "\n",
    "ext_trig.finalize()\n",
    "\n",
    "evaluator_trig = ext_trig.make_evaluator()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "id": "comparative-flight",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "dict_keys(['jet4_eff_40', 'jet4_eff_40_error', 'jet4_eff_45', 'jet4_eff_45_error', 'tau_eff_40', 'tau_eff_40_error', 'tau_eff_45', 'tau_eff_45_error'])"
      ]
     },
     "execution_count": 88,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "evaluator_trig.keys()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "checked-sleeping",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "sixth-might",
   "metadata": {},
   "outputs": [],
   "source": [
    "importlib.reload(btag)\n",
    "importlib.reload(weights)\n",
    "\n",
    "def candidates(sample, df, invert_btag = False, njets=-1):\n",
    "    \n",
    "    if \"Run2011\" in sample: isData = True\n",
    "    else: isData = False\n",
    "\n",
    "    print( \"Processing:\", sample,\"isData:\", isData, \"invert_btag:\", invert_btag)\n",
    "\n",
    "    df['nJets'] = df[\"Jet_pt\"].str.len()\n",
    "    \n",
    "    # b-tagging\n",
    "    df[\"Jet_nbtags\"] = df[\"Jet_csvDisc\"].apply( lambda x : btag.count_btags(x, njets=njets) )\n",
    "    if invert_btag:\n",
    "        df = btag.no_tag(df)\n",
    "    else:\n",
    "        df = btag.at_least_1tag(df)\n",
    "\n",
    "    # MET cut\n",
    "    df = selection.met_requirement(df)\n",
    "\n",
    "    \n",
    "    # HL features\n",
    "    #df = pd.concat([df, df.apply(lambda ev : pd.Series(hl.hlFeatures(ev, njets=njets)), axis=1)], axis=1)\n",
    "    \n",
    "\n",
    "    # MC weights\n",
    "    if not isData:\n",
    "\n",
    "        hlt_40, hlt_45 = weights.lumi()\n",
    "        total_lumi = hlt_40 + hlt_45\n",
    "        trigger_frac = hlt_40 / float(hlt_45)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(btag.eval_sf_eff(ev)), axis=1)], axis=1)\n",
    "        df[\"Jet_btag_weight1\"] = df.apply(lambda ev : btag.b_weight_method1(ev, njets=njets), axis=1)\n",
    "        #df[\"Jet_btag_weight2\"] = df.apply(lambda ev : btag.b_weight_method2(ev, njets=njets), axis=1)\n",
    "        # trigger weights\n",
    "        #df[\"trigger_weight\"] = df.apply(lambda ev : weights.trigger_weight(ev, trigger_frac), axis=1)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(weights.trigger_weight(ev, trigger_frac)), axis=1)], axis=1)\n",
    "        # normalization\n",
    "        counts_path = \"/eos/user/l/llayer/opendata_files/preselection_merged/\" + sample + \"_counts.root\"\n",
    "        total_counts = root_pandas.read_root(counts_path)\n",
    "        xsec = weights.get_xsec(sample)\n",
    "        weights.norm(df, total_counts, xsec, lumi = total_lumi)\n",
    "\n",
    "    # QCD\n",
    "    if isData & invert_btag:\n",
    "        \n",
    "        # Assume light flavour\n",
    "        def lf(nJets):\n",
    "            return np.zeros((nJets))\n",
    "        df[\"Jet_flavour\"] = df[\"nJets\"].apply(lf)\n",
    "        df = pd.concat([df, df.apply(lambda ev: pd.Series(btag.eval_sf_eff(ev)), axis=1)], axis=1)\n",
    "        df[\"btag_weight\"] = df.apply(lambda ev : btag.b_weight_method2(ev, njets=njets), axis=1)\n",
    "        \n",
    "    return df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "curious-milwaukee",
   "metadata": {},
   "outputs": [],
   "source": [
    "def rearrange_samples(samples):\n",
    "    \n",
    "    # Concat and split MC in signal and background\n",
    "    new_samples = {}\n",
    "    new_samples[\"TTJets_signal\"], new_samples[\"TTJets_bkg\"] = weights.classify_tt(samples[\"TTJets\"])\n",
    "    new_samples[\"WZJets\"] = pd.concat([samples['WJetsToLNu'], samples['DYJetsToLL']], axis=0)\n",
    "    new_samples[\"STJets\"] = pd.concat([samples['T_TuneZ2_s'], samples['T_TuneZ2_tW'], samples['T_TuneZ2_t-channel'], \n",
    "                              samples['Tbar_TuneZ2_s'], samples['Tbar_TuneZ2_tW'], \n",
    "                              samples['Tbar_TuneZ2_t-channel']], axis=0)\n",
    "\n",
    "    # Concat the data\n",
    "    new_samples[\"Data\"] = pd.concat([samples[\"Run2011A_MultiJet\"], samples[\"Run2011B_MultiJet\"]], axis=0)\n",
    "    new_samples[\"QCD\"] = pd.concat([samples[\"QCD_Run2011A_MultiJet\"], samples[\"QCD_Run2011B_MultiJet\"]], axis=0)\n",
    "    \n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "sized-iceland",
   "metadata": {},
   "outputs": [],
   "source": [
    "def proc_candidates(samples, njets = -1):\n",
    "    \n",
    "    cand_samples = {}\n",
    "    for sample in data:\n",
    "        cand_samples[sample] = candidates(sample, samples[sample], invert_btag = False, njets=njets)\n",
    "        cand_samples[\"QCD_\" + sample] = candidates(sample, samples[sample], invert_btag = True, njets=njets)\n",
    "    \n",
    "    \n",
    "    for sample in mc:\n",
    "        cand_samples[sample] = candidates(sample, samples[sample], invert_btag = False, njets=njets)   \n",
    "\n",
    "    new_samples = rearrange_samples(cand_samples)\n",
    "    return new_samples"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "together-ticket",
   "metadata": {},
   "outputs": [],
   "source": [
    "cands = proc_candidates(samples)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "elementary-columbia",
   "metadata": {},
   "outputs": [],
   "source": [
    "len(cands[\"Data\"])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "moved-terrace",
   "metadata": {},
   "outputs": [],
   "source": [
    "import ROOT\n",
    "from root_numpy import fill_hist\n",
    "\n",
    "def save_var(sample, name, var_name, bins = 20, xlow = 0., xup = 350):\n",
    "\n",
    "    hist = ROOT.TH1D(name + \"_\" + var_name, name + \"_\" + var_name, bins, xlow, xup)\n",
    "    hist.Sumw2()\n",
    "    \n",
    "    if name == \"Data\":\n",
    "        pass\n",
    "    elif name == \"QCD\":\n",
    "        if var_name == \"bdt\":\n",
    "            scale_qcd = 9.\n",
    "            sample = sample[sample[\"train_flag\"] == \"test\"]\n",
    "        else:\n",
    "            scale_qcd = 4.3\n",
    "        sample['weight'] = sample['btag_weight'] * scale_qcd\n",
    "    else:\n",
    "        #samples[sample]['new_trigger_weight'] = new_samples[sample].apply(lambda ev : weights.trigger_weight(ev), axis=1)\n",
    "        sample['weight'] = sample['norm'] * (1/1000) * sample['trigger_weight'] * sample['Jet_btag_weight1']\n",
    "        #print(sample, sum(samples[sample]['weight']))\n",
    "        #new_samples[sample]['btag_weight2']\n",
    "    \n",
    "    # Flatten if the column is a list\n",
    "    if \"Jet_\" in var_name:\n",
    "        series = sample[var_name].apply(pd.Series).stack().reset_index(drop=True)\n",
    "        if name != \"Data\":\n",
    "            sample['weight_stacked'] = sample.apply(lambda x : stack_weight(x[\"weight\"] ,x[\"nJets\"]), axis=1)\n",
    "            weights = sample['weight_stacked'].apply(pd.Series).stack().reset_index(drop=True)\n",
    "    else:\n",
    "        series = sample[var_name]\n",
    "        if name != \"Data\":\n",
    "            weights = sample[\"weight\"]\n",
    "    if name == \"Data\":\n",
    "        fill_hist(hist, series)\n",
    "    else:\n",
    "        fill_hist(hist, series, weights = weights)\n",
    "    #hist.Write()\n",
    "    return hist\n",
    "\n",
    "def vars_to_histos(samples, variables):\n",
    "    \n",
    "    hists = {}\n",
    "    for name, sample in samples.items():\n",
    "        for var in variables:\n",
    "            hists[name + \"_\" + var[\"var_name\"]] = save_var(sample, name, var[\"var_name\"], var[\"bins\"], var[\"xlow\"], var[\"xup\"])\n",
    "\n",
    "    return hists"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "sixth-mississippi",
   "metadata": {},
   "outputs": [],
   "source": [
    "variables = [\n",
    "    {\"var_name\" : \"MET_met\", \"bins\" : 30, \"xlow\" : 0., \"xup\" : 400, \"xtitle\" : \"MET [GeV]\"}\n",
    "]\n",
    "\n",
    "hists = vars_to_histos(cands, variables)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "intermediate-controversy",
   "metadata": {},
   "outputs": [],
   "source": [
    "f = ROOT.TFile(\"histos_test.root\", \"RECREATE\")\n",
    "for s, hist in hists.items():\n",
    "\n",
    "    print( s, hist.Integral() )\n",
    "    hist.Write()\n",
    "    \n",
    "f.Close()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "electronic-parker",
   "metadata": {},
   "outputs": [],
   "source": [
    "def fit(histos, fit_var, corr = \"central\"):\n",
    "        \n",
    "\n",
    "    bkg = histos['TTJets_bkg' + \"_\" + fit_var ].Clone()\n",
    "    bkg.Add(histos['WZJets' + \"_\" + fit_var ])\n",
    "    bkg.Add(histos['STJets' + \"_\" + fit_var ])\n",
    "\n",
    "    data = histos[\"Data\" + \"_\" + fit_var ].Clone()\n",
    "    data.Add(bkg, -1.)\n",
    "\n",
    "    signal = histos[\"TTJets_signal\" + \"_\" + fit_var ]\n",
    "\n",
    "    qcd = histos[\"QCD\" + \"_\" + fit_var ]\n",
    "\n",
    "    x = ROOT.RooRealVar(\"x\",\"x\",0.,350.)\n",
    "    rooSignal =  ROOT.RooDataHist(\"signal\",\"signal\",ROOT.RooArgList( x ), signal)\n",
    "    rooBkg = ROOT.RooDataHist(\"bkg\",\"bkg\", ROOT.RooArgList( x ), qcd)\n",
    "    signal_pdf = ROOT.RooHistPdf(\"signal\",\"signal\",ROOT.RooArgSet( x ), rooSignal)\n",
    "    bkg_pdf = ROOT.RooHistPdf(\"bkg\",\"bkg\",ROOT.RooArgSet( x ), rooBkg)\n",
    "\n",
    "    c0 = ROOT.RooRealVar(\"c0\",\"c0\",0.5,0.,1.)\n",
    "    pdf = ROOT.RooAddPdf(\"pdf\",\"pdf\", signal_pdf,bkg_pdf, c0)\n",
    "\n",
    "    dataFit = ROOT.RooDataHist(\"data\",\"data\",ROOT.RooArgList( x ), data);\n",
    "\n",
    "    fitResult = pdf.fitTo(dataFit)\n",
    "    #print( fitResult )\n",
    "\n",
    "    sf_tt_sig = (c0.getVal() * data.Integral()) / signal.Integral() \n",
    "    sf_tt_sig_err = (c0.getError() * data.Integral()) / signal.Integral()\n",
    "    \n",
    "    sf_qcd = ((1-c0.getVal())*data.Integral()) / qcd.Integral()\n",
    "    sf_qcd_err = (c0.getError() * data.Integral()) / qcd.Integral()\n",
    "    \n",
    "    \n",
    "    print( \"scale factor TTbar tau(h) QQ \", sf_tt_sig, \"+-\", sf_tt_sig_err )\n",
    "    print( \"scale factor MultiJet \", sf_qcd, \"+-\", sf_qcd_err )\n",
    "\n",
    "    return sf_tt_sig, sf_qcd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "decimal-dietary",
   "metadata": {},
   "outputs": [],
   "source": [
    "fit(hists, \"MET_met\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "answering-regulation",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
